name: Wake Up Render App

on:
  schedule:
    - cron: "55 14 * * *"

jobs:
  wake_up:
    runs-on: ubuntu-latest
    steps:
      - name: Wake up Render app before midnight job
        run: |
          echo "⏰ Pinging Render app to wake it up before midnight..."
          for i in {1..3}
          do
            RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" https://my-japan.onrender.com/api/v1/auth/health)
            if [ "$RESPONSE" -eq 200 ]; then
              echo "✅ App responded with 200 OK on attempt $i"
              exit 0
            else
              echo "⚠️ Attempt $i failed (HTTP $RESPONSE), retrying in 10s..."
              sleep 10
            fi
          done
          echo "❌ App did not respond after 3 attempts"
          exit 0  # Không cần fail toàn workflow
