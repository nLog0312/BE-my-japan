name: Wake Up Render App

on:
  schedule:
    - cron: "55 14 * * *"
  workflow_dispatch:

jobs:
  wake_up:
    runs-on: ubuntu-latest
    steps:
      - name: Wake up Render app before midnight job
        run: |
          echo "ðŸŒ Pinging Render app to wake it up before midnight..."
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" https://my-japan.onrender.com/api/v1/auth/health)
          if [ "$RESPONSE" -eq 200 ]; then
            STATUS_MSG="âœ… Render app responded with 200 OK"
          else
            STATUS_MSG="âš ï¸ Render app did not respond (HTTP $RESPONSE)"
          fi
          echo "$STATUS_MSG"
          echo "STATUS_MSG=$STATUS_MSG" >> $GITHUB_ENV

      - name: Send Telegram notification
        if: always()
        run: |
          echo "ðŸ“¨ Sending Telegram notification..."
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d "text=Wake Up Render App:%0A${{ env.STATUS_MSG }}%0ATime: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
